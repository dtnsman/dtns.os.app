(("undefined"!==typeof self?self:this)["webpackJsonpk_form_design"]=("undefined"!==typeof self?self:this)["webpackJsonpk_form_design"]||[]).push([[38],{"0553":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{style:{width:e.record.options.width}},[e.record.options.drag?t("UploadDragger",{class:{"hide-upload-drag":!(e.fileList.length<e.record.options.limit)},attrs:{disabled:e.record.options.disabled||e.parentDisabled,name:e.config.uploadFileName||e.record.options.fileName,headers:e.config.uploadFileHeaders||e.record.options.headers,data:e.config.uploadFileData||e.optionsData,action:e.config.uploadFile||e.record.options.action,multiple:e.record.options.multiple,fileList:e.fileList,remove:e.remove,beforeUpload:e.beforeUpload},on:{preview:e.handlePreview,change:e.handleChange}},[t("p",{staticClass:"ant-upload-drag-icon"},[t("a-icon",{attrs:{type:"cloud-upload"}})],1),t("p",{staticClass:"ant-upload-text"},[e._v("单击或拖动文件到此区域")])]):t("Upload",{attrs:{disabled:e.record.options.disabled||e.parentDisabled,name:e.config.uploadFileName||e.record.options.fileName,headers:e.config.uploadFileHeaders||e.record.options.headers,data:e.config.uploadFileData||e.optionsData,action:e.config.uploadFile||e.record.options.action,multiple:e.record.options.multiple,fileList:e.fileList,remove:e.remove,beforeUpload:e.beforeUpload},on:{preview:e.handlePreview,change:e.handleChange}},[e.fileList.length<e.record.options.limit?t("Button",{attrs:{disabled:e.record.options.disabled||e.parentDisabled}},[t("a-icon",{attrs:{type:"upload"}}),e._v(" "+e._s(e.record.options.placeholder)+" ")],1):e._e()],1)],1)},n=[],a=(i("f751"),i("96cf"),i("1da1")),l=(i("551c"),i("7f7f"),i("f64c")),s=i("e74d"),r=s["c"].getComponent("upload"),d=s["c"].getComponent("uploadDragger"),c=s["c"].getComponent("aButton").component,f={name:"KUploadFile",props:["record","value","config","parentDisabled","dynamicData"],components:{Upload:r.component,UploadDragger:d.component,Button:c},data:function(){return{fileList:[]}},watch:{value:{handler:function(e){e&&this.setFileList()},immediate:!0,deep:!0}},computed:{optionsData:function(){try{return JSON.parse(this.record.options.data)}catch(e){return console.error(e),{}}}},methods:{setFileList:function(){"string"===typeof this.value?(this.fileList=JSON.parse(this.value),this.handleSelectChange()):this.fileList=this.value},handleSelectChange:function(){var e=this;setTimeout((function(){var t=e.fileList.map((function(e){return e.response,{type:"file",name:e.name,status:e.status,uid:e.uid,url:e.url||""}}));e.$emit("change",t),e.$emit("input",t)}),10)},handlePreview:function(e){var t=this,i=this.record.options.downloadWay,o=this.record.options.dynamicFun;if("a"===i){var n=document.createElement("a");n.href=e.url||e.thumbUrl,n.download=e.name,n.click()}else"ajax"===i?this.getBlob(e.url||e.thumbUrl).then((function(i){t.saveAs(i,e.name)})):"dynamic"===i&&this.dynamicData[o](e)},getBlob:function(e){return new Promise((function(t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){200===i.status&&t(i.response)},i.send()}))},saveAs:function(e,t){if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(e,t);else{var i=document.createElement("a"),o=document.querySelector("body");i.href=window.URL.createObjectURL(e),i.download=t,i.style.display="none",o.appendChild(i),i.click(),o.removeChild(i),window.URL.revokeObjectURL(i.href)}},remove:function(){this.handleSelectChange()},beforeUpload:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,i){var o,n,a,s,r,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i.length+this.fileList.length>this.record.options.limit&&(l["a"].warning("最大上传数量为".concat(this.record.options.limit)),i.splice(this.record.options.limit-this.fileList.length)),console.log("beforeUpload:files:",i,t),console.log("fileList:",this.fileList),o=window.g_dtnsManager,console.log("g_dtnsManager:",o),"undefined"==typeof o){e.next=15;break}return console.log("g_dtnsManager:",o),n={file:t},a={fieldname:"file",encoding:"fromfile_binary",originalname:n.file.name,mimetype:n.file.type,filename:n.file.name,path:"file-path",size:n.file.size,user_id:localStorage.user_id,s_id:localStorage.s_id,file_kind:"file",random:Math.random(),data:n.file},s=window.rpc_client,e.next=12,new Promise((function(e){s.sendFile(a,(function(t){console.log("sendFile-callback-data:"+JSON.stringify(t)),e(t)}))}));case 12:r=e.sent,console.log("upload-file-ret:"+JSON.stringify(r)),r.data.ret?(console.log("上传成功"+r.data.msg,3e3),d={type:"file",name:n.file.name,status:"done",uid:n.file.uid,url:r.data.filename,originFileObj:{uid:n.file.uid},xhr:{},response:"ok",percent:0,lastModified:1685528081370,lastModifiedDate:"2023-05-31T10:14:41.370Z"},console.log("resultObj:",d),this.resultObj=d,this.fileList.push(d)):console.log("上传失败"+r.data.msg,3e3);case 15:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}(),handleChange:function(e){if(this.fileList=e.fileList,console.log("handleChange-this.fileList:",this.fileList),"done"===e.file.status){var t=e.file.response;0===t.code||Object.assign(this.fileList[this.fileList.length-1],this.resultObj)}else"error"===e.file.status&&Object.assign(this.fileList[this.fileList.length-1],this.resultObj);this.handleSelectChange()}}},p=f,u=i("2877"),h=Object(u["a"])(p,o,n,!1,null,null,null),g=h.exports;t["default"]=g}}]);