window.ZhChess=function(e){"use strict";var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},t(e,r)};function r(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var n=function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var i=function(){function e(e,t){Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.x=e,this.y=t}return Object.defineProperty(e.prototype,"toString",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"(".concat(this.x,",").concat(this.y,")")}}),e}(),o=function(e){function t(t,r,n){var o=e.call(this,t,r)||this;return Object.defineProperty(o,"disPoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),o.disPoint=new i(n.x,n.y),o}return r(t,e),Object.defineProperty(t.prototype,"toString",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=!(10===this.disPoint.x&&10===this.disPoint.y);return"(".concat(this.x,",").concat(this.y,")").concat(e?"<阻碍点"+this.disPoint+">":"")}}),t}(i),a={x:10,y:10},c=function(e,t){return e.find((function(e){return e.x===t.x&&e.y===t.y}))},u=function(){function e(e){Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"side",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isChoose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isLastMove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.x=e.x,this.y=e.y,this.name=e.name,this.side=e.side,this.isChoose=e.isChoose||!1,this.isLastMove=e.isLastMove}return Object.defineProperty(e.prototype,"toString",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"[".concat(this.side,"方]:").concat(this.name,"(").concat(this.x,",").concat(this.y,")")}}),Object.defineProperty(e.prototype,"filterMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this;return e.filter((function(e){var n=t.find((function(t){return t.x===e.x&&t.y===e.y&&t.side===r.side}));return e.x>=0&&e.x<=8&&e.y>=0&&e.y<=9&&!n}))}}),Object.defineProperty(e.prototype,"getCurrentInfo",{enumerable:!1,configurable:!0,writable:!0,value:function(){return{side:this.side,name:this.name,x:this.x,y:this.y,isLastMove:this.isLastMove}}}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.x=e.x,this.y=e.y}}),Object.defineProperty(e.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o,a,c,u,s){var l=this.isChoose?"red":"#000",f=t+Math.abs(this.x-o)*n,h=r+Math.abs(this.y-a)*i,b=c;e.fillStyle=s;var v=function(t,r,n,i,o){e.beginPath(),e.arc(t,r,n,i,o),e.closePath(),e.stroke()};(this.isChoose||this.isLastMove)&&(b/=.9),e.beginPath(),e.arc(f,h+0,b,0,2*Math.PI),e.shadowOffsetX=3,e.shadowOffsetY=4,e.shadowColor="#333",e.shadowBlur=5,e.fill(),e.closePath(),e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.strokeStyle=l,v(f,h+0,b,0,2*Math.PI),v(f,h+0,b-3,0,2*Math.PI),e.textAlign="center",e.textBaseline="middle",e.fillStyle=u,e.font=c+"px yahei",e.fillText(this.name,f,h+0)}}),Object.defineProperty(e.prototype,"getMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return[]}}),Object.defineProperty(e.prototype,"drawMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o,a,c,u,s){e.fillStyle=s,this.getMovePoints(t).forEach((function(t){var s=r+Math.abs(t.x-a)*i,l=n+Math.abs(t.y-c)*o;e.beginPath(),e.arc(s,l,.25*u,0,2*Math.PI),e.closePath(),e.fill()}))}}),Object.defineProperty(e.prototype,"getPoint",{enumerable:!1,configurable:!0,writable:!0,value:function(){return new i(this.x,this.y)}}),e}(),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"getMoveObstaclePieceList",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this,n=this.x===e.x?"y":"x",i="x"===n?"y":"x",o=this[n]-e[n],a=o>0?e[n]:this[n],c=o<0?e[n]:this[n];return t.filter((function(t){var o=!(r.x===t.x&&r.y===t.y),u=t[i]===e[i],s=t[n]>a&&t[n]<c,l=t.side===r.side,f=t[n]>=a&&t[n]<=c;return u&&o&&s||u&&o&&l&&f}))}}),Object.defineProperty(t.prototype,"move",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(e.x<0||e.x>8||e.y<0||e.y>9)return{flag:!1,message:"移动位置不符合规则"};if(this.y===e.y||this.x===e.x){var r=this.getMoveObstaclePieceList(e,t);return r.length>0?{flag:!1,message:"移动距离中存在障碍物："+r.join("---")}:{flag:!0}}return{flag:!1,message:"移动位置不符合规则"}}}),Object.defineProperty(t.prototype,"getMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,r=Array.from({length:9},(function(e,r){return new o(r,t.y,a)})),n=Array.from({length:10},(function(e,r){return new o(t.x,r,a)})),i=r.concat(n).filter((function(e){return!(t.x===e.x&&t.y===e.y)}));return e?i.filter((function(r){return!0===t.move(r,e).flag})):i}}),t}(u),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"getMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=[],r=0;r<2;r++){var n=this.x-2,i=2*r+(this.y-1);t.push(new o(n,i,{x:this.x-1,y:this.y}));var a=this.x+2,c=i;t.push(new o(a,c,{x:this.x+1,y:this.y}));var u=2*r+(this.x-1),s=this.y-2;t.push(new o(u,s,{x:this.x,y:this.y-1}));var l=u,f=this.y+2;t.push(new o(l,f,{x:this.x,y:this.y+1}))}return this.filterMovePoints(t,e)}}),Object.defineProperty(t.prototype,"filterMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){return e.prototype.filterMovePoints.call(this,t,r).filter((function(e){return!Boolean(c(r,e.disPoint))}))}}),Object.defineProperty(t.prototype,"move",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.getMovePoints(t).find((function(t){return e.x===t.x&&e.y===t.y}));if(!r)return{flag:!1,message:"".concat(this,"走法错误，不可以落在").concat(e,"上")};var n=t.find((function(e){return e.x===r.disPoint.x&&e.y===r.disPoint.y}));return n?{flag:!1,message:"".concat(this,"走法错误，").concat(n,"卡住了").concat(this.name,"的去向")}:{flag:!0}}}),t}(u),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"getMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=[],r=0;r<2;r++){var n=this.x-2+4*r,i=this.y-2,a=this.x-1+2*r,u=this.y-1;t.push(new o(n,i,{x:a,y:u}));var s=this.x-2+4*r,l=this.y+2,f=a,h=this.y+1;t.push(new o(s,l,{x:f,y:h}))}return this.filterMovePoints(t,e).filter((function(t){return!Boolean(c(e,t.disPoint))}))}}),Object.defineProperty(t.prototype,"filterMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this;return e.filter((function(e){return!t.find((function(t){return t.x===e.x&&t.y===e.y&&t.side===r.side}))&&e.x>=0&&e.x<=8&&e.y>=0&&e.y<=9&&("RED"===r.side&&e.y>=5||"BLACK"===r.side&&e.y<=4)}))}}),t}(l),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"getMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=[],r=0;r<2;r++){var n=this.x-1+2*r,i=this.y-1;t.push(new o(n,i,a));var c=this.x-1+2*r,u=this.y+1;t.push(new o(c,u,a))}return this.filterMovePoints(t,e)}}),Object.defineProperty(t.prototype,"filterMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this;return e.filter((function(e){return!t.find((function(t){return t.x===e.x&&t.y===e.y&&t.side===r.side}))&&e.x<=5&&e.x>=3&&("RED"===r.side&&e.y>=7&&e.y<=9||"BLACK"===r.side&&e.y>=0&&e.y<=2)}))}}),t}(f),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"getMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=[new o(this.x-1,this.y,a),new o(this.x+1,this.y,a),new o(this.x,this.y-1,a),new o(this.x,this.y+1,a)];return this.filterMovePoints(t,e)}}),t}(h),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"move",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(e.x<0||e.x>8||e.y<0||e.y>9)return{flag:!1,message:"移动位置不符合规则"};if(this.y===e.y||this.x===e.x){var r=this.getMoveObstaclePieceList(e,t);if(r.length>1)return{flag:!1,message:"移动距离存在多个炮架："+r.join("---")};if(1===r.length&&r[0].x===e.x&&r[0].y===e.y)return{flag:!1,message:"无法击中敌方棋子(缺少炮架)，移动无效"};var n=t.find((function(t){return t.x===e.x&&t.y===e.y}));return 1===r.length?n?{flag:!0}:{flag:!1,message:"无法击中敌方棋子，移动无效"}:0===r.length&&n?{flag:!1,message:"无法击中敌方棋子(缺少炮架)，移动无效"}:{flag:!0}}return{flag:!1,message:"移动位置不符合规则"}}}),t}(s),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"getMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t="RED"===this.side?this.y<=4:this.y>=5,r="RED"===this.side?-1:1,n=new o(this.x,this.y+r,a),i=t?[n,new o(this.x-1,this.y,a),new o(this.x+1,this.y,a)]:[n];return this.filterMovePoints(i,e)}}),t}(l),y={"仕":function(e){return new h(e)},"兵":function(e){return new d(e)},"卒":function(e){return new d(e)},"士":function(e){return new h(e)},"将":function(e){return new b(e)},"帅":function(e){return new b(e)},"炮":function(e){return new v(e)},"相":function(e){return new f(e)},"砲":function(e){return new v(e)},"象":function(e){return new f(e)},"車":function(e){return new s(e)},"车":function(e){return new s(e)},"馬":function(e){return new l(e)},"马":function(e){return new l(e)}},p=["前","中","后"],g=["进","平","退"],m="(".concat(g.join("|"),")"),P=["1","2","3","4","5","6","7","8","9"].concat(["一","二","三","四","五","六","七","八","九"]),w="(".concat(P.join("|"),")"),x="(".concat(Object.keys(y).join("|"),")"),O=new RegExp("(".concat(p.concat(P).join("|"),")").concat(x).concat(m).concat(w,"$")),j=new RegExp("".concat(x).concat(w).concat(m).concat(w,"$")),E=new RegExp("(".concat(p.join("|"),")").concat(w).concat(m).concat(w,"$")),S=function(e,t,r){var n,o,a,c=r.filter((function(e){return e.side===t})),u="RED"===t,s="BLACK"===t?8:0,l="BLACK"===t?9:0,f=u?1:-1;if(E.test(e)&&(o=E.exec(e))){var h=Math.abs(C(o[2])-1-s),b=o[3],v=C(o[4]),d=M("兵",t);if("平"===b&&(v-=1),(w=c.filter((function(e){return e.x===h&&e.name===d}))).length<2)return!1;w.sort((function(e,t){return u?e.y-t.y:t.y-e.y}));var y=w[3===w.length?C(o[1])-1:"前"===o[1]?0:1],m=Math.abs(y.y-l),P=u?m-v*f:m+v*f;if(b===g[0])return{mp:new i(y.x,P),choose:y};if(b===g[1])return{mp:new i(Math.abs(v-s),m),choose:y}}if(O.test(e)&&(n=O.exec(e))){O.lastIndex=0;var w,x=M(n[2],t);b=n[3],v=C(n[4]);if("平"===b&&(v-=1),(w=c.filter((function(e){return e.name===x}))).length<2)return!1;var S,L=0,k={};w.forEach((function(e){k[e.x]?k[e.x]+=1:k[e.x]=1}));for(var T=Object.keys(k),A=0;A<T.length;A++){var B=k[T[A]];if(L<B)L=B;else if(L===B)return!1}if(S=T[0],(L=k[S])<2)return!1;var D=w.filter((function(e){return String(e.x)===S})),R=n[1];if(R===p[1]&&3!==L)return!1;if(L>=3){D.sort((function(e,t){return u?e.y-t.y:t.y-e.y}));y=D[C(R)-1],m=Math.abs(y.y-l),P=u?m-v*f:m+v*f;if(b===g[0])return{mp:new i(y.x,P),choose:y};if(b===g[1])return{mp:new i(Math.abs(v-s),m),choose:y}}if(2===L&&p.filter((function(e){return"中"!==e})).includes(R)){m=(y=D[R===p[0]?0:1]).y;var F=(W=y.x)-v;if(b===g[0]||b===g[2]){var I=Math.abs(F),G=b===g[2]?-1:1;if("马"===x||"馬"===x){if(I>=1&&I<=2){var K=1==I;return{choose:y,mp:new i(q=F<0?K?W-1*f:W-2*f:K?W+1*f:W+2*f,K?m-2*f*G:m-1*f*G)}}return!1}var _=["仕","士"];if(($=["相","象"].includes(x))||_.includes(x)){var N=$?2:1;return(!$||3===I)&&(!(!$&&1!==I)&&{choose:y,mp:new i(q=F>0?W+N*f:W-N*f,m-N*f*G)})}return{choose:y,mp:new i(W,P=m-v*f*G)}}if(b===g[1])return{choose:y,mp:new i(Math.abs(v-s),m)}}return!1}if(j.test(e)&&(a=j.exec(e))){var X=M(a[1],t),Y=C(a[2])-1;b=a[3],v=C(a[4]);"平"===b&&(v-=1);var H=Math.abs(Y-s);if(!(y=c.filter((function(e){return e.x===H&&e.name===X}))).length)return!1;if(y.length>=2)return!1;m=y[0].y;var W=y[0].x;F=Math.abs(W-s)-v,I=Math.abs(F);if(b===g[0]||b===g[2]){G=b===g[2]?-1:1;if("马"===X||"馬"===X){var V=Math.abs(Math.abs(W-s)-(v-1));if(V>=1&&V<=2){var z=(K=1===V)?m-2*f*G:m-1*f*G,q=F+1<0?K?W+1*f:W+2*f:K?W-1*f:W-2*f;return{choose:y[0],mp:new i(q,z)}}return!1}var $;_=["仕","士"];if(($=["相","象"].includes(X))||_.includes(X)){N=$?2:1;if($&&3!==I)return!1;if(!$&&1!==I)return!1;q=F>0?W+N*f:W-N*f;var U=m-N*f*G;return{choose:y[0],mp:new i(q,U)}}P=m-v*f*G;return{choose:y[0],mp:new i(W,P)}}if(b===g[1])return{choose:y[0],mp:new i(Math.abs(v-s),m)}}return!1};function M(e,t){switch(e){case"车":case"車":return"BLACK"===t?"車":"车";case"兵":case"卒":return"BLACK"===t?"卒":"兵";case"仕":case"士":return"BLACK"===t?"仕":"士";case"将":case"帅":return"BLACK"===t?"将":"帅";case"炮":case"砲":return"BLACK"===t?"砲":"炮";case"相":case"象":return"BLACK"===t?"象":"相";case"馬":case"马":return"BLACK"===t?"馬":"马";default:return null}}function C(e){switch(e){case"1":case"一":case"前":return 1;case"2":case"二":case"中":return 2;case"3":case"三":case"后":return 3;case"4":case"四":return 4;case"5":case"五":return 5;case"6":case"六":return 6;case"7":case"七":return 7;case"8":case"八":return 8;case"9":case"九":return 9;default:return 10}}function L(e){switch(e){case"K":return"帅";case"k":return"将";case"A":return"士";case"a":return"仕";case"B":return"相";case"b":return"象";case"N":return"马";case"n":return"馬";case"R":return"车";case"r":return"車";case"C":return"炮";case"c":return"砲";case"P":return"兵";case"p":return"卒";default:return null}}function k(e){switch(e){case"将":case"帅":return"k";case"仕":case"士":return"a";case"象":case"相":return"b";case"馬":case"马":return"n";case"車":case"车":return"r";case"砲":case"炮":return"c";case"卒":case"兵":return"p";default:return null}}function T(e){var t=function(e){return/\d/.test(e)},r=e.match(/(.*)\s+(w|b)\s*(-\s*-\s*(\d)+\s*(\d)+)?/);if(!r)throw new Error("不符合 PEN 棋盘布局代码格式!");var n=r[1],i=function(e){switch(e){case"b":case"B":return"BLACK";default:return"RED"}}(r[2]),o=r[4],a=r[5],c=n.split("/");if(10!==c.length)throw new Error("不符合 PEN 棋盘布局代码格式!");for(var u=[],s=0;s<c.length;s++){var l=c[s],f=9,h=l.length;if(h>9)throw new Error("不符合 PEN 棋盘布局代码格式!");for(var b=0;b<h;b++,f--){var v=l[b],d=L(v);if(d){var y=v.toLocaleLowerCase()===v?"BLACK":"RED";u.push({side:y,name:d,x:9-f,y:s,isLastMove:!1})}else t(v)&&(f-=Number(v)-1)}}return{side:i,notEatRound:o,round:a,list:u}}function A(e,t){var r=Array.from({length:10},(function(){return[]}));e.forEach((function(e){var t=e.getCurrentInfo(),n=t.y;r[n].push(t)})),r=r.map((function(e){return e=e.sort((function(e,t){return e.x-t.x}))}));for(var n="",i=0;i<r.length;i++){var o=r[i],a=o.length;0===a&&(n+="9");for(var c=0;c<a;c++){var u=o[c],s="RED"===u.side,l=k(u.name);if(!l)throw new Error("未找到 ".concat(u.name,' 对应的 PEN 代码，请检查棋子名称是否符合正确格式:\n例如： 车 "车","車"...'));var f=u.x-(c>0?o[c-1].x+1:0);if(f>0&&(n+=String(f)),n+=s?l.toUpperCase():l,c+1===a){var h=8-u.x;h>0&&(n+=String(h))}}i<r.length-1&&(n+="/")}return n+" "+function(e){return"BLACK"===e?"b":"w"}(t)}function B(e){return{x:parseInt(String.fromCharCode(e.charCodeAt(0)-49)),y:9-Number(e.charAt(1))}}var D="rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w";function R(e,t,r){return[n({},e),{x:t+e.x,y:e.y},{x:t+e.x,y:e.y+r},{x:e.x,y:e.y+r}]}var F="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},I=function(e){return e&&e.Math===Math&&e},G=I("object"==typeof globalThis&&globalThis)||I("object"==typeof window&&window)||I("object"==typeof self&&self)||I("object"==typeof F&&F)||I("object"==typeof F&&F)||function(){return this}()||Function("return this")(),K={},_=function(e){try{return!!e()}catch(e){return!0}},N=!_((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),X=!_((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),Y=X,H=Function.prototype.call,W=Y?H.bind(H):function(){return H.apply(H,arguments)},V={},z={}.propertyIsEnumerable,q=Object.getOwnPropertyDescriptor,$=q&&!z.call({1:2},1);V.f=$?function(e){var t=q(this,e);return!!t&&t.enumerable}:z;var U,Z,J=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Q=X,ee=Function.prototype,te=ee.call,re=Q&&ee.bind.bind(te,te),ne=Q?re:function(e){return function(){return te.apply(e,arguments)}},ie=ne,oe=ie({}.toString),ae=ie("".slice),ce=_,ue=function(e){return ae(oe(e),8,-1)},se=Object,le=ne("".split),fe=ce((function(){return!se("z").propertyIsEnumerable(0)}))?function(e){return"String"===ue(e)?le(e,""):se(e)}:se,he=function(e){return null==e},be=he,ve=TypeError,de=function(e){if(be(e))throw new ve("Can't call method on "+e);return e},ye=fe,pe=de,ge=function(e){return ye(pe(e))},me="object"==typeof document&&document.all,Pe=void 0===me&&void 0!==me?function(e){return"function"==typeof e||e===me}:function(e){return"function"==typeof e},we=Pe,xe=function(e){return"object"==typeof e?null!==e:we(e)},Oe=G,je=Pe,Ee=function(e,t){return arguments.length<2?(r=Oe[e],je(r)?r:void 0):Oe[e]&&Oe[e][t];var r},Se=ne({}.isPrototypeOf),Me=G,Ce="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Le=Me.process,ke=Me.Deno,Te=Le&&Le.versions||ke&&ke.version,Ae=Te&&Te.v8;Ae&&(Z=(U=Ae.split("."))[0]>0&&U[0]<4?1:+(U[0]+U[1])),!Z&&Ce&&(!(U=Ce.match(/Edge\/(\d+)/))||U[1]>=74)&&(U=Ce.match(/Chrome\/(\d+)/))&&(Z=+U[1]);var Be=Z,De=_,Re=G.String,Fe=!!Object.getOwnPropertySymbols&&!De((function(){var e=Symbol("symbol detection");return!Re(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Be&&Be<41})),Ie=Fe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ge=Ee,Ke=Pe,_e=Se,Ne=Object,Xe=Ie?function(e){return"symbol"==typeof e}:function(e){var t=Ge("Symbol");return Ke(t)&&_e(t.prototype,Ne(e))},Ye=String,He=Pe,We=function(e){try{return Ye(e)}catch(e){return"Object"}},Ve=TypeError,ze=function(e){if(He(e))return e;throw new Ve(We(e)+" is not a function")},qe=he,$e=W,Ue=Pe,Ze=xe,Je=TypeError,Qe={exports:{}},et=G,tt=Object.defineProperty,rt=function(e,t){try{tt(et,e,{value:t,configurable:!0,writable:!0})}catch(r){et[e]=t}return t},nt=rt,it="__core-js_shared__",ot=G[it]||nt(it,{}),at=ot;(Qe.exports=function(e,t){return at[e]||(at[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.35.0",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.35.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ct=Qe.exports,ut=de,st=Object,lt=function(e){return st(ut(e))},ft=ne({}.hasOwnProperty),ht=Object.hasOwn||function(e,t){return ft(lt(e),t)},bt=ne,vt=0,dt=Math.random(),yt=bt(1..toString),pt=function(e){return"Symbol("+(void 0===e?"":e)+")_"+yt(++vt+dt,36)},gt=ct,mt=ht,Pt=pt,wt=Fe,xt=Ie,Ot=G.Symbol,jt=gt("wks"),Et=xt?Ot.for||Ot:Ot&&Ot.withoutSetter||Pt,St=W,Mt=xe,Ct=Xe,Lt=function(e,t){var r=e[t];return qe(r)?void 0:ze(r)},kt=function(e,t){var r,n;if("string"===t&&Ue(r=e.toString)&&!Ze(n=$e(r,e)))return n;if(Ue(r=e.valueOf)&&!Ze(n=$e(r,e)))return n;if("string"!==t&&Ue(r=e.toString)&&!Ze(n=$e(r,e)))return n;throw new Je("Can't convert object to primitive value")},Tt=TypeError,At=function(e){return mt(jt,e)||(jt[e]=wt&&mt(Ot,e)?Ot[e]:Et("Symbol."+e)),jt[e]}("toPrimitive"),Bt=function(e,t){if(!Mt(e)||Ct(e))return e;var r,n=Lt(e,At);if(n){if(void 0===t&&(t="default"),r=St(n,e,t),!Mt(r)||Ct(r))return r;throw new Tt("Can't convert object to primitive value")}return void 0===t&&(t="number"),kt(e,t)},Dt=Xe,Rt=function(e){var t=Bt(e,"string");return Dt(t)?t:t+""},Ft=xe,It=G.document,Gt=Ft(It)&&Ft(It.createElement),Kt=function(e){return Gt?It.createElement(e):{}},_t=!N&&!_((function(){return 7!==Object.defineProperty(Kt("div"),"a",{get:function(){return 7}}).a})),Nt=N,Xt=W,Yt=V,Ht=J,Wt=ge,Vt=Rt,zt=ht,qt=_t,$t=Object.getOwnPropertyDescriptor;K.f=Nt?$t:function(e,t){if(e=Wt(e),t=Vt(t),qt)try{return $t(e,t)}catch(e){}if(zt(e,t))return Ht(!Xt(Yt.f,e,t),e[t])};var Ut={},Zt=N&&_((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Jt=xe,Qt=String,er=TypeError,tr=function(e){if(Jt(e))return e;throw new er(Qt(e)+" is not an object")},rr=N,nr=_t,ir=Zt,or=tr,ar=Rt,cr=TypeError,ur=Object.defineProperty,sr=Object.getOwnPropertyDescriptor,lr="enumerable",fr="configurable",hr="writable";Ut.f=rr?ir?function(e,t,r){if(or(e),t=ar(t),or(r),"function"==typeof e&&"prototype"===t&&"value"in r&&hr in r&&!r[hr]){var n=sr(e,t);n&&n[hr]&&(e[t]=r.value,r={configurable:fr in r?r[fr]:n[fr],enumerable:lr in r?r[lr]:n[lr],writable:!1})}return ur(e,t,r)}:ur:function(e,t,r){if(or(e),t=ar(t),or(r),nr)try{return ur(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new cr("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var br=Ut,vr=J,dr=N?function(e,t,r){return br.f(e,t,vr(1,r))}:function(e,t,r){return e[t]=r,e},yr={exports:{}},pr=N,gr=ht,mr=Function.prototype,Pr=pr&&Object.getOwnPropertyDescriptor,wr=gr(mr,"name"),xr={EXISTS:wr,PROPER:wr&&"something"===function(){}.name,CONFIGURABLE:wr&&(!pr||pr&&Pr(mr,"name").configurable)},Or=Pe,jr=ot,Er=ne(Function.toString);Or(jr.inspectSource)||(jr.inspectSource=function(e){return Er(e)});var Sr,Mr,Cr,Lr=jr.inspectSource,kr=Pe,Tr=G.WeakMap,Ar=kr(Tr)&&/native code/.test(String(Tr)),Br=pt,Dr=ct("keys"),Rr={},Fr=Ar,Ir=G,Gr=xe,Kr=dr,_r=ht,Nr=ot,Xr=function(e){return Dr[e]||(Dr[e]=Br(e))},Yr=Rr,Hr="Object already initialized",Wr=Ir.TypeError,Vr=Ir.WeakMap;if(Fr||Nr.state){var zr=Nr.state||(Nr.state=new Vr);zr.get=zr.get,zr.has=zr.has,zr.set=zr.set,Sr=function(e,t){if(zr.has(e))throw new Wr(Hr);return t.facade=e,zr.set(e,t),t},Mr=function(e){return zr.get(e)||{}},Cr=function(e){return zr.has(e)}}else{var qr=Xr("state");Yr[qr]=!0,Sr=function(e,t){if(_r(e,qr))throw new Wr(Hr);return t.facade=e,Kr(e,qr,t),t},Mr=function(e){return _r(e,qr)?e[qr]:{}},Cr=function(e){return _r(e,qr)}}var $r={set:Sr,get:Mr,has:Cr,enforce:function(e){return Cr(e)?Mr(e):Sr(e,{})},getterFor:function(e){return function(t){var r;if(!Gr(t)||(r=Mr(t)).type!==e)throw new Wr("Incompatible receiver, "+e+" required");return r}}},Ur=ne,Zr=_,Jr=Pe,Qr=ht,en=N,tn=xr.CONFIGURABLE,rn=Lr,nn=$r.enforce,on=$r.get,an=String,cn=Object.defineProperty,un=Ur("".slice),sn=Ur("".replace),ln=Ur([].join),fn=en&&!Zr((function(){return 8!==cn((function(){}),"length",{value:8}).length})),hn=String(String).split("String"),bn=yr.exports=function(e,t,r){"Symbol("===un(an(t),0,7)&&(t="["+sn(an(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!Qr(e,"name")||tn&&e.name!==t)&&(en?cn(e,"name",{value:t,configurable:!0}):e.name=t),fn&&r&&Qr(r,"arity")&&e.length!==r.arity&&cn(e,"length",{value:r.arity});try{r&&Qr(r,"constructor")&&r.constructor?en&&cn(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=nn(e);return Qr(n,"source")||(n.source=ln(hn,"string"==typeof t?t:"")),e};Function.prototype.toString=bn((function(){return Jr(this)&&on(this).source||rn(this)}),"toString");var vn=yr.exports,dn=Pe,yn=Ut,pn=vn,gn=rt,mn={},Pn=Math.ceil,wn=Math.floor,xn=Math.trunc||function(e){var t=+e;return(t>0?wn:Pn)(t)},On=function(e){var t=+e;return t!=t||0===t?0:xn(t)},jn=On,En=Math.max,Sn=Math.min,Mn=On,Cn=Math.min,Ln=function(e){return e>0?Cn(Mn(e),9007199254740991):0},kn=ge,Tn=function(e,t){var r=jn(e);return r<0?En(r+t,0):Sn(r,t)},An=function(e){return Ln(e.length)},Bn=function(e){return function(t,r,n){var i,o=kn(t),a=An(o),c=Tn(n,a);if(e&&r!=r){for(;a>c;)if((i=o[c++])!=i)return!0}else for(;a>c;c++)if((e||c in o)&&o[c]===r)return e||c||0;return!e&&-1}},Dn={includes:Bn(!0),indexOf:Bn(!1)},Rn=ht,Fn=ge,In=Dn.indexOf,Gn=Rr,Kn=ne([].push),_n=function(e,t){var r,n=Fn(e),i=0,o=[];for(r in n)!Rn(Gn,r)&&Rn(n,r)&&Kn(o,r);for(;t.length>i;)Rn(n,r=t[i++])&&(~In(o,r)||Kn(o,r));return o},Nn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");mn.f=Object.getOwnPropertyNames||function(e){return _n(e,Nn)};var Xn={};Xn.f=Object.getOwnPropertySymbols;var Yn=Ee,Hn=mn,Wn=Xn,Vn=tr,zn=ne([].concat),qn=Yn("Reflect","ownKeys")||function(e){var t=Hn.f(Vn(e)),r=Wn.f;return r?zn(t,r(e)):t},$n=ht,Un=qn,Zn=K,Jn=Ut,Qn=_,ei=Pe,ti=/#|\.prototype\./,ri=function(e,t){var r=ii[ni(e)];return r===ai||r!==oi&&(ei(t)?Qn(t):!!t)},ni=ri.normalize=function(e){return String(e).replace(ti,".").toLowerCase()},ii=ri.data={},oi=ri.NATIVE="N",ai=ri.POLYFILL="P",ci=ri,ui=G,si=K.f,li=dr,fi=function(e,t,r,n){n||(n={});var i=n.enumerable,o=void 0!==n.name?n.name:t;if(dn(r)&&pn(r,o,n),n.global)i?e[t]=r:gn(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=r:yn.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},hi=rt,bi=function(e,t,r){for(var n=Un(t),i=Jn.f,o=Zn.f,a=0;a<n.length;a++){var c=n[a];$n(e,c)||r&&$n(r,c)||i(e,c,o(t,c))}},vi=ci,di=G;(function(e,t){var r,n,i,o,a,c=e.target,u=e.global,s=e.stat;if(r=u?ui:s?ui[c]||hi(c,{}):(ui[c]||{}).prototype)for(n in t){if(o=t[n],i=e.dontCallGetSet?(a=si(r,n))&&a.value:r[n],!vi(u?n:c+(s?".":"#")+n,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;bi(o,i)}(e.sham||i&&i.sham)&&li(o,"sham",!0),fi(r,n,o,e)}})({global:!0,forced:di.globalThis!==di},{globalThis:di});var yi=function(e,t){return e.find((function(e){return e.x===t.x&&e.y===t.y}))},pi=function(){function e(e){var t,r=e.ctx,n=e.gameWidth,i=void 0===n?800:n,o=e.gameHeight,a=void 0===o?800:o,c=e.gamePadding,u=void 0===c?20:c,s=e.scaleRatio,l=void 0===s?1:s,f=e.duration,h=void 0===f?200:f,b=e.redPeiceBackground,v=void 0===b?"#feeca0":b,d=e.blackPeiceBackground,y=void 0===d?"#fdec9e":d,p=e.checkerboardBackground,g=void 0===p?"#faebd7":p,m=e.movePointColor,P=void 0===m?"#25dd2a":m,w=e.drawMovePoint,x=void 0===w||w;Object.defineProperty(this,"currentSide",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"livePieceList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"choosePiece",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"startX",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endX",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"startY",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endY",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gridWidth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gridHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"radius",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gridPostionList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"duration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"drawMovePoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gridDiffX",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gridDiffY",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gameState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"moveEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"moveFailEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"overEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"errorEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"redPeiceBackground",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blackPeiceBackground",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkerboardBackground",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"winner",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"gameSide",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"animate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cancelAnimate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scaleRatio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"movePointColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastMovePoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastMovePiece",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.moveEvents=[],this.moveFailEvents=[],this.logEvents=[],this.overEvents=[],this.errorEvents=[],this.ctx=r,this.redPeiceBackground=v,this.blackPeiceBackground=y,this.checkerboardBackground=g,this.movePointColor=P,null===(t=this.ctx)||void 0===t||t.scale(l,l),this.scaleRatio=l,this.listenClick=this.listenClick.bind(this),this.listenClickAsync=this.listenClickAsync.bind(this),this.checkDraw=this.checkDraw.bind(this),this.gridPostionList=[],this.drawMovePoint=x,this.setGridList(),this.gameState="INIT",this.duration=h,this.setGameWindow(i,a,u),this.init(),this.animate=globalThis.requestAnimationFrame||globalThis.webkitRequestAnimationFrame||globalThis.mozRequestAnimationFrame||globalThis.oRequestAnimationFrame||globalThis.msRequestAnimationFrame||function(e){return globalThis.setTimeout(e,1e3/60)},this.cancelAnimate=globalThis.cancelAnimationFrame||globalThis.webkitCancelAnimationFrame||globalThis.mozCancelAnimationFrame||globalThis.oCancelAnimationFrame||globalThis.msCancelAnimationFrame||globalThis.clearTimeout}return Object.defineProperty(e.prototype,"setGameWindow",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){for(var n=t-2*r,i=n;i%9!=0;)i++;this.gridWidth=i/9,this.gridHeight=n/10,this.startX=(e-i+this.gridWidth)/2,this.startY=(t-n+this.gridHeight)/2,this.endX=this.startX+8*this.gridWidth,this.endY=this.startY+9*this.gridHeight,this.radius=.4*this.gridHeight,this.width=e,this.height=t}}),Object.defineProperty(e.prototype,"getGridDiff",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return"BLACK"===e?"x"===t?8:9:0}}),Object.defineProperty(e.prototype,"setGridDiff",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.gridDiffX=this.getGridDiff(e,"x"),this.gridDiffY=this.getGridDiff(e,"y")}}),Object.defineProperty(e.prototype,"setGridList",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e=0;e<9;e++)for(var t=0;t<10;t++)this.gridPostionList.push(new i(e,t))}}),Object.defineProperty(e.prototype,"getGridPosition",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;return this.gridPostionList.find((function(r){var n=Math.abs(r.x-t.gridDiffX)*t.gridWidth+t.startX,i=Math.abs(r.y-t.gridDiffY)*t.gridHeight+t.startY;return Math.sqrt(Math.pow(n-e.x,2)+Math.pow(i-e.y,2))<t.radius}))}}),Object.defineProperty(e.prototype,"init",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.currentSide="RED",this.choosePiece=null,this.livePieceList=[]}}),Object.defineProperty(e.prototype,"initPiece",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.setPenCodeList(D),this.choosePiece=null,this.checkDraw()}}),Object.defineProperty(e.prototype,"updateAsync",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,o){var a=this,c=this.update(e,t,r,!1);if(this.gameState="MOVE",!c.flag||!t||c.flag&&!c.move)return this.gameState="START",Promise.resolve(c);var u,s=e.x-t.x,l=e.y-t.y,f=e.x,h=e.y,b=s/(this.duration/16),v=l/(this.duration/16),d=yi(this.livePieceList,new i(f,h));return new Promise((function(r){var c=function(){if(Math.abs(f-t.x)<=Math.abs(b)&&Math.abs(h-t.y)<=Math.abs(v))return a.cancelAnimate.call(globalThis,u),d&&d.update(e),r(null);var s=new i(f-=b,h-=v);d&&(d.isChoose=!1,d.update(s),n&&a.checkDraw(),"function"==typeof o&&o(d,s)),u=a.animate.call(globalThis,c)};c()})).catch((function(e){return a.errorEvents.forEach((function(t){return t(e)})),null})).then((function(){return c.flag&&c.cb?(c.cb(),n&&a.checkDraw(),{flag:!0,move:!0}):c}))}}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,o){var a=this,c=this.checkGameState();if(!c.flag)return c;if(this.currentSide!==r)return{flag:!1,message:"请等待对方下棋"};var u=yi(this.livePieceList,e);if(!u)return{flag:!1,message:"未找到棋子"};if(this.currentSide!==u.side)return{flag:!1,message:"选中了敌方的棋子"};if(this.clearMoveChoosePeiece(),u.isChoose=!0,this.setLastMovePeiceStatus(!1),this.choosePiece=u,!t)return this.logEvents.forEach((function(e){return e(r+"方： 选中 "+u)})),{flag:!0,move:!1};var s=yi(this.livePieceList,t),l=this.choosePiece.move(t,this.livePieceList),f=function(c){var s="move"in c;if(a.checkGeneralInTrouble(r,u,c,a.livePieceList))return{flag:!1,message:"不可以送将！"};var l="RED"===r?"BLACK":"RED",f=!1,h=a.checkGeneralInTrouble(l,u,c,a.livePieceList),b=s?a.livePieceList.filter((function(e){return!(e.x===u.x&&e.y===u.y)})):a.livePieceList.filter((function(e){return!(e.x===u.x&&e.y===u.y||e.x===c.eat.x&&e.y===c.eat.y)})),v=y[u.name](n(n({},u),t));(b.push(v),h)?(a.logEvents.forEach((function(e){return e(r+"方： 将军")})),a.checkEnemySideInTroubleHasSolution(l,b)||(f=!0,a.winner=r)):a.checkEnemySideHasMovePoints(l,b)||(f=!0,a.winner=r);var d=function(){var o=y[u.name](n(n({},u),e));s||(a.livePieceList=a.livePieceList.filter((function(e){return!(e.x===c.eat.x&&e.y===c.eat.y)}))),a.setLastMovePeiceStatus(!1),u.update(t),a.lastMovePiece=u,a.setLastMovePeiceStatus(!0),a.lastMovePoint=new i(e.x,e.y),a.gameState="START",f&&(a.gameState="OVER"),a.moveEvents.forEach((function(e){return e(o,c,f||h,a.getCurrentPenCode(l))})),f&&a.overEvents.forEach((function(e){return e(r)})),a.clearMoveChoosePeiece(),a.changeSide()};return o?(d(),{flag:!0,move:!0}):{flag:!0,cb:d,move:!0}};if(!s)return l.flag?f({move:t}):l;if(s.side===r)return e.x===t.x&&e.y===t.y?(this.clearMoveChoosePeiece(),this.setLastMovePeiceStatus(!0),this.logEvents.forEach((function(e){return e(r+"方： 取消选中 "+s)})),{flag:!0,move:!1}):(this.choosePiece.isChoose=!1,this.choosePiece=s,this.choosePiece.isChoose=!0,this.logEvents.forEach((function(e){return e("".concat(a.currentSide,"方：切换 选中棋子 由").concat(a.choosePiece," --\x3e ").concat(s))})),{flag:!0,move:!1});if(this.logEvents.forEach((function(e){return e("当前：".concat(a.currentSide," ,棋子:").concat(a.choosePiece," 需要移动到：").concat(t," 这个点上，并且要吃掉 ").concat(s))})),l.flag){var h=f({eat:t});return h&&this.logEvents.forEach((function(e){return e(a.currentSide+"吃了"+s)})),h}return l}}),Object.defineProperty(e.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;e.clearRect(0,0,this.width,this.height),this.drawChessLine(e);var r=this,n=r.startX,i=r.startY,o=r.gridWidth,a=r.gridHeight,c=r.gridDiffX,u=r.gridDiffY,s=r.radius,l=r.movePointColor;if(this.livePieceList.forEach((function(r){var l="BLACK"===r.side?"#000":"#c1190c",f="BLACK"===r.side?t.blackPeiceBackground:t.redPeiceBackground;if(t.choosePiece===r||t.lastMovePiece===r)return!0;r.draw(e,n,i,o,a,c,u,s,l,f)})),this.lastMovePiece){var f="BLACK"===this.lastMovePiece.side?"#000":"#c1190c",h="BLACK"===this.lastMovePiece.side?this.blackPeiceBackground:this.redPeiceBackground;this.lastMovePiece.draw(e,n,i,o,a,c,u,s,f,h)}if(this.choosePiece){f="BLACK"===this.choosePiece.side?"#000":"#c1190c",h="BLACK"===this.choosePiece.side?this.blackPeiceBackground:this.redPeiceBackground;this.choosePiece.draw(e,n,i,o,a,c,u,s,f,h),this.drawMovePoint&&"MOVE"!==this.gameState&&this.choosePiece.drawMovePoints(e,this.livePieceList,n,i,o,a,c,u,s,l)}}}),Object.defineProperty(e.prototype,"drawChessLine",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,r=t.startX,n=t.startY,i=t.endX,o=t.endY,a=t.gridWidth,c=t.gridHeight,u=t.scaleRatio;e.fillStyle=this.checkerboardBackground,e.fillRect(0,0,this.width,this.width),e.strokeStyle="#000";for(var s=0;s<10;s++){e.beginPath();var l=n+c*s;e.moveTo(r,l),e.lineTo(i,l),e.closePath(),e.stroke()}for(s=0;s<9;s++){var f=r+s*a,h=n+4*c,b=n+9*c;0!==s&&8!==s?(e.beginPath(),e.moveTo(f,n),e.lineTo(f,h),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(f,h+c),e.lineTo(f,o),e.closePath(),e.stroke()):(e.beginPath(),e.moveTo(f,n),e.lineTo(f,b),e.closePath(),e.stroke())}for(s=0;s<2;s++){var v=R({x:f=r+3*a,y:n+7*c*s},2*a,2*c);e.beginPath(),e.moveTo(v[0].x,v[0].y),e.lineTo(v[2].x,v[2].y),e.moveTo(v[1].x,v[1].y),e.lineTo(v[3].x,v[3].y),e.closePath(),e.stroke()}for(var d=0;d<9;d+=2){for(var y=.15*a,p=.1*a,g=0;g<2;g++)for(var m=0===g?-p:+p,P=0===g?+p:-p,w=0===g?+y:-y,x=0;x<2;x++){l=x%2==0?n+3*c:n+6*c;for(var O=0;O<2;O++){var j=O%2==0?-w:+w;(f=O%2==0?r+d*a+m:r+d*a-m)-r>0&&f-(r+8*a)<0&&(e.beginPath(),e.moveTo(f,l+P),e.lineTo(f+j,l+P),e.moveTo(f,l+P),e.lineTo(f,l+P+w),e.stroke())}}if(d-1==1||d-1==7)for(g=0;g<2;g++){m=0===g?-p:+p,P=0===g?+p:-p,w=0===g?+y:-y;var E=r+(d-1)*a;for(x=0;x<2;x++)for(l=(x%2==0?n+2*c:n+7*c)+P,O=0;O<2;O++){f=O%2==0?E+m:E-m,j=O%2==0?-w:+w;e.beginPath(),e.moveTo(f,l),e.lineTo(f+j,l),e.moveTo(f,l),e.lineTo(f,l+w),e.stroke()}}}e.textBaseline="middle",e.textAlign="left",e.fillStyle="#000";var S=.7*c;e.font=S+"px serif",e.fillText("楚河",r+a,n+4.5*c),e.textAlign="right",e.translate(r+7*a-2*S,n+4.5*c),e.rotate(Math.PI),e.fillText("汉界",0,0),e.setTransform(u,0,0,u,0,0)}}),Object.defineProperty(e.prototype,"moveStr",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this;if(!this.checkGameState())return{flag:!1,message:"当前游戏状态不可以移动棋子"};if(this.logEvents.forEach((function(r){return r("当前 ".concat(t," 输出：").concat(e))})),this.currentSide!==t)return this.logEvents.forEach((function(e){return e("当前为".concat(r.currentSide,"方下棋，请等待！"))})),{flag:!1,message:"当前为".concat(this.currentSide,"方下棋，请等待！")};var n=S(e,this.currentSide,this.livePieceList);if(!n)return this.logEvents.forEach((function(e){return e("未找到棋子")})),{flag:!1,message:"未找到棋子"};this.choosePiece&&this.clearMoveChoosePeiece();var i=yi(this.livePieceList,n.mp);return i&&i.side===this.currentSide?(this.logEvents.forEach((function(e){return e("移动的位置有己方棋子")})),{flag:!1,message:"移动的位置有己方棋子"}):(this.choosePiece=n.choose,this.choosePiece.isChoose=!0,this.update(n.choose,n.mp,t,!0))}}),Object.defineProperty(e.prototype,"moveStrAsync",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=this;if(!this.checkGameState())return Promise.resolve({flag:!1,message:"当前游戏状态不可以移动棋子"});if(this.logEvents.forEach((function(r){return r("当前 ".concat(t," 输出：").concat(e))})),this.currentSide!==t)return this.logEvents.forEach((function(e){return e("当前为".concat(n.currentSide,"方下棋，请等待！"))})),Promise.resolve({flag:!1,message:"当前为".concat(this.currentSide,"方下棋，请等待！")});var i=S(e,this.currentSide,this.livePieceList);return i?(this.choosePiece&&this.clearMoveChoosePeiece(),this.choosePiece=i.choose,this.choosePiece.isChoose=!0,this.updateAsync(i.choose.getPoint(),i.mp,t,r)):(this.logEvents.forEach((function(e){return e("未找到棋子")})),Promise.resolve({flag:!1,message:"未找到棋子"}))}}),Object.defineProperty(e.prototype,"gameStart",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.init(),this.setGridDiff(e),this.gameState="START",this.winner=null,this.lastMovePoint=void 0,this.lastMovePiece=void 0,this.gameSide=e,this.initPiece()}}),Object.defineProperty(e.prototype,"clearMoveChoosePeiece",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.choosePiece&&(this.choosePiece.isChoose=!1,this.choosePiece=null)}}),Object.defineProperty(e.prototype,"changeSide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.currentSide="RED"===this.currentSide?"BLACK":"RED"}}),Object.defineProperty(e.prototype,"changePlaySide",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setGridDiff(e),this.clearMoveChoosePeiece(),this.checkDraw()}}),Object.defineProperty(e.prototype,"changeCurrentPlaySide",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.currentSide=e}}),Object.defineProperty(e.prototype,"gameOver",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"OVER"===this.gameState}}),Object.defineProperty(e.prototype,"checkGeneralInTrouble",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,o){var a,c="BLACK"===e?"RED":"BLACK";if("move"in r){var u=n(n({},t),r.move),s=y[u.name](u);(a=o.filter((function(e){return!(e.x===t.x&&e.y===t.y)}))).push(s)}else{u=n(n({},t),r.eat),s=y[u.name](u);(a=o.filter((function(e){return!(e.x===r.eat.x&&e.y===r.eat.y||e.x===t.x&&e.y===t.y)}))).push(s)}if(this.checkGeneralsFaceToFaceInTrouble(a))return!0;var l=a.filter((function(e){return e.side===c})),f=a.find((function(t){return t.side===e&&t instanceof b})),h=new i(f.x,f.y);return l.some((function(e){return e.move(h,a).flag}))}}),Object.defineProperty(e.prototype,"checkGeneralsFaceToFaceInTrouble",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.filter((function(e){return e instanceof b})).map((function(e){return{x:e.x,y:e.y}})),r=t[0].y>t[1].y?t[0].y:t[1].y,n=t[0].y<t[1].y?t[0].y:t[1].y;return t[0].x===t[1].x&&!e.find((function(e){return e.y<r&&e.y>n&&e.x===t[0].x}))}}),Object.defineProperty(e.prototype,"checkEnemySideInTroubleHasSolution",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this;return t.filter((function(t){return t.side===e})).some((function(n){return n.getMovePoints(t).some((function(i){if(yi(t,i.disPoint))return!1;var o=yi(t,i)?{eat:i}:{move:i};return!r.checkGeneralInTrouble(e,n,o,t)}))}))}}),Object.defineProperty(e.prototype,"checkEnemySideHasMovePoints",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this,n=t;return!!n.filter((function(t){return t.side===e})).find((function(t){return t.getMovePoints(n).find((function(i){var o=yi(n,i)?{eat:i}:{move:i};return!r.checkGeneralInTrouble(e,t,o,n)}))}))}}),Object.defineProperty(e.prototype,"checkGameState",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e;if(!(e="INIT"===this.gameState?{flag:!1,message:"请选择红黑方"}:"OVER"===this.gameState?{flag:!1,message:"棋盘结束 等待重开！"}:"MOVE"===this.gameState?{flag:!1,message:"棋子正在移动，无法做任何操作"}:{flag:!0}).flag){var t=e.message;this.logEvents.forEach((function(e){return e(t)})),this.moveFailEvents.forEach((function(e){return e(null,null,t)}))}return e}}),Object.defineProperty(e.prototype,"checkDraw",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.ctx)try{this.draw(this.ctx),this.drawLastMovePoint(this.ctx)}catch(e){this.errorEvents.forEach((function(t){return t(e)}))}else this.errorEvents.forEach((function(e){return e(new Error("未找到画布，无法更新当前棋盘布局画面！"))}))}}),Object.defineProperty(e.prototype,"listenClick",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,r,n=e.offsetX,o=e.offsetY;if(this.checkGameState().flag){var a=this.getGridPosition({x:n,y:o});if(!a){var c="点击的位置未找到棋子";return this.logEvents.forEach((function(e){return e(c)})),void this.moveFailEvents.forEach((function(e){return e(null,null,c)}))}var u=Boolean(this.choosePiece),s=u?new i(null===(t=this.choosePiece)||void 0===t?void 0:t.x,null===(r=this.choosePiece)||void 0===r?void 0:r.y):a,l=u?a:null,f=this.currentSide;this.update(s,l,f,!0),this.checkDraw()}}}),Object.defineProperty(e.prototype,"listenClickAsync",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,r,n=this,o=e.offsetX,a=e.offsetY;if(this.checkGameState().flag){var c=this.getGridPosition({x:o,y:a});if(!c){var u="点击的位置未找到棋子";return this.logEvents.forEach((function(e){return e(u)})),void this.moveFailEvents.forEach((function(e){return e(null,null,u)}))}var s=Boolean(this.choosePiece),l=s?new i(null===(t=this.choosePiece)||void 0===t?void 0:t.x,null===(r=this.choosePiece)||void 0===r?void 0:r.y):c,f=s?c:null,h=this.currentSide;this.updateAsync(l,f,h,!0).then((function(e){n.checkDraw(),e.flag||n.moveFailEvents.forEach((function(t){return t(l,f,e.message)}))}))}}}),Object.defineProperty(e.prototype,"getCurrentSideVal",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.currentSide}}),Object.defineProperty(e.prototype,"getChoosePieceVal",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.choosePiece}}),Object.defineProperty(e.prototype,"winnerSide",{get:function(){return this.winner},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentGameSide",{get:function(){return this.gameSide},set:function(e){console.log("设置值无效：".concat(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentLivePieceList",{get:function(){return this.livePieceList.map((function(e){return y[e.name](n({},e))}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentRadius",{get:function(){return this.radius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getCurrentPenCode",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return A(this.livePieceList,e)}}),Object.defineProperty(e.prototype,"on",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if("function"!=typeof t)throw new Error("监听函数值应该为 function 类型");"log"===e?this.logEvents.push(t):"move"===e?this.moveEvents.push(t):"moveFail"===e?this.moveFailEvents.push(t):"over"===e?this.overEvents.push(t):"error"===e&&this.errorEvents.push(t)}}),Object.defineProperty(e.prototype,"removeEvent",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if("function"!=typeof t)throw new Error("监听函数值应该为 function 类型");"log"===e?this.logEvents=this.logEvents.filter((function(e){return e!==t})):"move"===e?this.moveEvents=this.moveEvents.filter((function(e){return e!==t})):"moveFail"===e?this.moveFailEvents=this.moveFailEvents.filter((function(e){return e!==t})):"over"===e?this.overEvents=this.overEvents.filter((function(e){return e!==t})):"error"===e&&(this.errorEvents=this.errorEvents.filter((function(e){return e!==t})))}}),Object.defineProperty(e.prototype,"setLivePieceList",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.livePieceList=e}}),Object.defineProperty(e.prototype,"setPenCodeList",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=T(e);this.setLastMovePeiceStatus(!1),this.clearMoveChoosePeiece(),this.lastMovePiece=void 0,this.lastMovePoint=void 0,this.livePieceList=t.list.map((function(e){return y[e.name](e)})),this.currentSide=t.side}}),Object.defineProperty(e.prototype,"drawLastMovePoint",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!this.choosePiece&&this.lastMovePoint&&e){var t=this.startX+Math.abs(this.lastMovePoint.x-this.gridDiffX)*this.gridWidth,r=this.startY+Math.abs(this.lastMovePoint.y-this.gridDiffY)*this.gridHeight;e.beginPath(),e.arc(t,r,.8*this.radius,0,2*Math.PI);var n=e.createRadialGradient(t,r,.05*this.radius,t,r,.8*this.radius);n.addColorStop(0,this.movePointColor),n.addColorStop(1,"rgba(255,255,255,0)"),e.closePath(),e.fillStyle=n,e.fill()}}}),Object.defineProperty(e.prototype,"setLastMovePeiceStatus",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.lastMovePiece&&(this.lastMovePiece.isLastMove=e)}}),e}();return e.CannonPiece=v,e.ElephantPiece=f,e.GeneralPiece=b,e.HorsePiece=l,e.KnightPiece=h,e.MovePoint=o,e.Piece=u,e.Point=i,e.RookPiece=s,e.SoldierPiece=d,e.chessOfPeiceMap=y,e.default=pi,e.diffPenStr=function(e,t){var r=T(e).list,n=T(t).list,o=r.map((function(e){return y[e.name](e)})),a=[],c=[];return r.forEach((function(e){var t=n.findIndex((function(t){return t.x===e.x&&e.y===t.y&&e.side===t.side&&t.name===e.name}));if(-1===t){var r=y[e.name](e).getMovePoints(o);if(r.length)r.find((function(t){var r=n.findIndex((function(r){return r.x===t.x&&r.y===t.y&&r.side===e.side&&r.name===e.name})),o=-1!==r;return o&&(c.push({point:new i(e.x,e.y),move:new i(n[r].x,n[r].y),side:e.side}),n.splice(r,1)),o}))||a.push(e);else a.push(e)}else n.splice(t,1)})),{moveList:c,delList:a}},e.gen_PEN_Point_Str=function(e){var t=e.x,r=e.y;return String.fromCharCode(String(t).charCodeAt(0)+49)+String(9-r)},e.gen_PEN_Str=A,e.initBoardPen=D,e.parse_PEN_Point_Str=function(e){if(4!==e.length)return null;var t=e.slice(0,2),r=e.slice(2);return{point:B(t),move:B(r)}},e.parse_PEN_Str=T,e.peiceSideMap={RED:"红方",BLACK:"黑方"},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
