"use strict";(self["webpackChunkdtns_creator"]=self["webpackChunkdtns_creator"]||[]).push([[758],{9363:function(t,e,i){i.r(e),i.d(e,{default:function(){return d}});var a=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{overflow:"hidden"},on:{click:t.clickNow}},[e("canvas",{ref:"canvas"})])},l=[],n=i(2689),s=i.p+"img/title.07a15c19.jpg",r={extends:n.Z,props:{propValue:{type:Object,required:!0,default:()=>{},url:"default"},element:{type:Object,default:()=>{}}},data(){return{width:0,height:0,img:null,canvas:null,ctx:null,isFirst:!0,img_url:null}},watch:{"element.style.width":function(){this.drawImage()},"element.style.height":function(){this.drawImage()},"propValue.url":async function(){await this.drawImage()},"propValue.flip.vertical":function(){this.mirrorFlip()},"propValue.flip.horizontal":function(){this.mirrorFlip()}},async mounted(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),this.poplang=new PopRuntime(this),this.poplang.binderAddOpcode("init",(async()=>{this.xdata=this.element.xdata,console.log("pic-this.xdata:",this.xdata);let t=await this.poplang.runScript(null,this.element.code);console.log("code:"+this.element.code,"url:",this.propValue,"pic_run_rets:",t,"img_url:",this.img_url),this.drawImage()})),this.element.poplang=this.poplang,this.drawImage(),this.poplang},methods:{async drawImage(){let t=this;const{width:e,height:i}=this.element.style;this.canvas.width=e,this.canvas.height=i;let a=this.img_url?this.img_url:this.propValue.url,l=a&&a.startsWith("data:image/");if("default"==a||l)return this.img=document.createElement("img"),this.img.onload=()=>{this.ctx.drawImage(t.img,0,0,e,i),t.mirrorFlip()},void(this.img.src=l?a:s);{this.img=document.createElement("img"),this.img.setAttribute("crossOrigin","Anonymous"),this.img.onload=()=>{this.ctx.drawImage(t.img,0,0,e,i),t.mirrorFlip()};let l=a,n=l&&l.startsWith("dtns://")?{}:{filename:l,img_kind:"open"},s=l&&l.startsWith("dtns://")?l:"",r=await imageDb.getDataByKey(l);if(r&&r.data)this.img.src=r.data;else{let t=this;queryImg(s,n).then((async e=>{let i="data:image/png;base64,"+e.data;t.img.src=i,imageDb.addData({img_id:l,data:i})}))}}},async clickNow(t){let e=await this.poplang.op(null,"onclick");console.log("pic-onclick-ret:",e)},mirrorFlip(){const{vertical:t,horizontal:e}=this.propValue.flip,{width:i,height:a}=this.element.style,l=e?-1:1,n=t?-1:1;this.ctx.clearRect(0,0,i,a),this.ctx.translate(i/2-i*l/2,a/2-a*n/2),this.ctx.scale(l,n),this.ctx.drawImage(this.img,0,0,i,a),this.ctx.setTransform(1,0,0,1,0,0)}}},h=r,o=i(1001),c=(0,o.Z)(h,a,l,!1,null,null,null),d=c.exports},2689:function(t,e,i){i.d(e,{Z:function(){return c}});var a,l,n=i(4003),s={props:{linkage:{type:Object,default:()=>{}},element:{type:Object,default:()=>{}}},created(){this.linkage?.data?.length&&(n.Z.$on("v-click",this.onClick),n.Z.$on("v-hover",this.onHover))},mounted(){const{data:t,duration:e}=this.linkage||{};t?.length&&(this.$el.style.transition=`all ${e}s`)},beforeDestroy(){this.linkage?.data?.length&&(n.Z.$off("v-click",this.onClick),n.Z.$off("v-hover",this.onHover))},methods:{changeStyle(t=[]){t.forEach((t=>{t.style.forEach((t=>{t.key&&(this.element.style[t.key]=t.value)}))}))},onClick(t){const e=this.linkage.data.filter((e=>e.id===t&&"v-click"===e.event));this.changeStyle(e)},onHover(t){const e=this.linkage.data.filter((e=>e.id===t&&"v-hover"===e.event));this.changeStyle(e)}}},r=s,h=i(1001),o=(0,h.Z)(r,a,l,!1,null,null,null),c=o.exports}}]);
//# sourceMappingURL=758.a77cb05a.js.map