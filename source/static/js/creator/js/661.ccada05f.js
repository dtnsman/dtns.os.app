"use strict";(self["webpackChunkdtns_creator"]=self["webpackChunkdtns_creator"]||[]).push([[661],{3661:function(t,e,a){a.r(e),a.d(e,{default:function(){return S}});var o=function(){var t=this,e=t._self._c;return e("div",{ref:"container",staticClass:"bg"},[t.isScreenshot?e("el-button",{staticClass:"close",on:{click:t.htmlToImage}},[t._v("确定")]):e("el-button",{staticClass:"close",on:{click:t.close}},[t._v("关闭")]),e("div",{staticClass:"canvas-container"},[e("div",{staticClass:"canvas",style:{...t.getCanvasStyle(t.canvasStyleData),width:t.changeStyleWithScale(t.canvasStyleData.width)+"px",height:t.changeStyleWithScale(t.canvasStyleData.height)+"px"}},t._l(t.copyData,(function(t,a){return e("ComponentWrapper",{key:a,attrs:{config:t}})})),1)])],1)},n=[],s=a(9748),l=a(1169),c=a(1457),i=a(4842),r=a(2648);var p={components:{ComponentWrapper:l.Z},props:{isScreenshot:{type:Boolean,default:!1}},data(){return{copyData:[],componentData:null,canvasStyleData:null}},beforeCreate(){console.log("canvasStyleData:"+JSON.stringify(this.canvasStyleData))},async created(){window.g_dchatManager&&window.g_dchatManager.setViewContext(this),this.restore(),console.log("tmpJson:"+JSON.stringify((0,r.p$)(this.componentData))),this.copyData=(0,r.p$)(this.componentData),console.log("this.config:"+JSON.stringify(this.canvasStyleData)),this.poplang=new PopRuntime({}),window.poplang=this.poplang;const t=localStorage.getItem("protocol_config");console.log("protocolCache:"+JSON.stringify(t)),t?(this.poplang.setProtocol(JSON.parse(t)),this.isok="ok"):this.isok=!1,await this.poplang.runScript(null,this.canvasStyleData.code,!0);let e=await this.poplang.op(null,"beforeCreate");console.log("beforeCreateRet:",e,"$ret:",this.poplang.context.$ret,this.poplang.context);for(let a=0;a<this.copyData.length;a++){let t=this.copyData[a];t.xdata={...this.poplang.context.$ret},t.poplang&&t.poplang.op(null,"init")}this.poplang.op(null,"created")},beforeMount(){},async mounted(){},beforeDestroy(){},destroyed(){},methods:{getStyle:s.C2,getCanvasStyle:s.$i,changeStyleWithScale:c.EY,restore(){localStorage.getItem("canvasData")&&(this.componentData=JSON.parse(localStorage.getItem("canvasData"))),localStorage.getItem("canvasStyle")&&(this.canvasStyleData=JSON.parse(localStorage.getItem("canvasStyle")))},close(){this.$router.push("/")},async htmlToImage(){let t=this.$refs.container.querySelector(".canvas");const e=await(0,i.KR)(t);console.log("ele-info:"+t.style.width+","+t.style.height+"padding:"+t.style.padding),console.log("ele-info:"+t.style.width+","+t.style.height),(0,i.YM)(t,{fontEmbedCss:e}).then((t=>{const e=document.createElement("a");e.setAttribute("download","screenshot"),e.href=t,e.click()})).catch((t=>{console.error("oops, something went wrong!",t)})).finally(this.close),console.log("ele-info:"+t.style.width)}}},h=p,g=a(1001),y=(0,g.Z)(h,o,n,!1,null,"0c096f66",null),S=y.exports}}]);
//# sourceMappingURL=661.ccada05f.js.map